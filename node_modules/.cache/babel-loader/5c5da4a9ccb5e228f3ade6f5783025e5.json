{"ast":null,"code":"import _regeneratorRuntime from\"/Users/christophervouga/Documents/projects/fake-id/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/christophervouga/Documents/projects/fake-id/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import{GoogleAuthProvider,onAuthStateChanged,signInWithRedirect,signOut as firebaseSignOut}from\"firebase/auth\";import{useEffect}from\"react\";import create from\"zustand\";import{auth}from\"./firebase\";var useStore=create(function(set){return{authState:{status:\"loading\"},setAuthState:function setAuthState(authState){return set({authState:authState});}};});export var useAuth=function useAuth(){var _useStore=useStore(),authState=_useStore.authState,setAuthState=_useStore.setAuthState;useEffect(function(){var unsubscribe=onAuthStateChanged(auth,function(firebaseUser){if(firebaseUser){setAuthState({status:\"auth\",authUser:{userId:firebaseUser.uid}});return;}setAuthState({status:\"unauth\"});});return function(){unsubscribe();};},[setAuthState]);var signIn=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(_ref){var authMethod,googleAuthProvider;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:authMethod=_ref.authMethod;if(!(authMethod===\"google\")){_context.next=6;break;}googleAuthProvider=new GoogleAuthProvider();_context.next=5;return signInWithRedirect(auth,googleAuthProvider);case 5:return _context.abrupt(\"return\",[]);case 6:return _context.abrupt(\"return\",[new Error(\"unsupported auth method\")]);case 7:case\"end\":return _context.stop();}}},_callee);}));return function signIn(_x){return _ref2.apply(this,arguments);};}();var signOut=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return firebaseSignOut(auth);case 2:case\"end\":return _context2.stop();}}},_callee2);}));return function signOut(){return _ref3.apply(this,arguments);};}();return{authState:authState,signIn:signIn,signOut:signOut};};export var useAuthUser=function useAuthUser(){var _useAuth=useAuth(),authState=_useAuth.authState;if(authState.status===\"auth\"){return authState.authUser;}throw new Error(\"Trying to use auth user in an unauth context\");};","map":{"version":3,"sources":["/Users/christophervouga/Documents/projects/fake-id/src/data-access/auth.ts"],"names":["GoogleAuthProvider","onAuthStateChanged","signInWithRedirect","signOut","firebaseSignOut","useEffect","create","auth","useStore","set","authState","status","setAuthState","useAuth","unsubscribe","firebaseUser","authUser","userId","uid","signIn","authMethod","googleAuthProvider","Error","useAuthUser"],"mappings":"+UAAA,OACEA,kBADF,CAEEC,kBAFF,CAGEC,kBAHF,CAIEC,OAAO,GAAIC,CAAAA,eAJb,KAKO,eALP,CAMA,OAASC,SAAT,KAA0B,OAA1B,CACA,MAAOC,CAAAA,MAAP,KAAmB,SAAnB,CACA,OAASC,IAAT,KAAqB,YAArB,CAuBA,GAAMC,CAAAA,QAAQ,CAAGF,MAAM,CAAS,SAACG,GAAD,QAAU,CACxCC,SAAS,CAAE,CACTC,MAAM,CAAE,SADC,CAD6B,CAIxCC,YAAY,CAAE,sBAACF,SAAD,QAAeD,CAAAA,GAAG,CAAC,CAAEC,SAAS,CAATA,SAAF,CAAD,CAAlB,EAJ0B,CAAV,EAAT,CAAvB,CAOA,MAAO,IAAMG,CAAAA,OAAO,CAAG,QAAVA,CAAAA,OAAU,EAAM,CAC3B,cAAoCL,QAAQ,EAA5C,CAAQE,SAAR,WAAQA,SAAR,CAAmBE,YAAnB,WAAmBA,YAAnB,CAEAP,SAAS,CAAC,UAAM,CACd,GAAMS,CAAAA,WAAW,CAAGb,kBAAkB,CAACM,IAAD,CAAO,SAACQ,YAAD,CAAkB,CAC7D,GAAIA,YAAJ,CAAkB,CAChBH,YAAY,CAAC,CACXD,MAAM,CAAE,MADG,CAEXK,QAAQ,CAAE,CACRC,MAAM,CAAEF,YAAY,CAACG,GADb,CAFC,CAAD,CAAZ,CAMA,OACD,CAEDN,YAAY,CAAC,CACXD,MAAM,CAAE,QADG,CAAD,CAAZ,CAGD,CAdqC,CAAtC,CAgBA,MAAO,WAAM,CACXG,WAAW,GACZ,CAFD,CAGD,CApBQ,CAoBN,CAACF,YAAD,CApBM,CAAT,CAsBA,GAAMO,CAAAA,MAAM,2FAAG,yKAASC,UAAT,MAASA,UAAT,MACTA,UAAU,GAAK,QADN,0BAELC,kBAFK,CAEgB,GAAIrB,CAAAA,kBAAJ,EAFhB,uBAILE,CAAAA,kBAAkB,CAACK,IAAD,CAAOc,kBAAP,CAJb,wCAMJ,EANI,yCASN,CAAC,GAAIC,CAAAA,KAAJ,CAAU,yBAAV,CAAD,CATM,wDAAH,kBAANH,CAAAA,MAAM,6CAAZ,CAYA,GAAMhB,CAAAA,OAAO,2FAAG,+JACRC,CAAAA,eAAe,CAACG,IAAD,CADP,yDAAH,kBAAPJ,CAAAA,OAAO,2CAAb,CAIA,MAAO,CACLO,SAAS,CAATA,SADK,CAELS,MAAM,CAANA,MAFK,CAGLhB,OAAO,CAAPA,OAHK,CAAP,CAKD,CA9CM,CAgDP,MAAO,IAAMoB,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,EAAM,CAC/B,aAAsBV,OAAO,EAA7B,CAAQH,SAAR,UAAQA,SAAR,CAEA,GAAIA,SAAS,CAACC,MAAV,GAAqB,MAAzB,CAAiC,CAC/B,MAAOD,CAAAA,SAAS,CAACM,QAAjB,CACD,CAED,KAAM,IAAIM,CAAAA,KAAJ,CAAU,8CAAV,CAAN,CACD,CARM","sourcesContent":["import {\n  GoogleAuthProvider,\n  onAuthStateChanged,\n  signInWithRedirect,\n  signOut as firebaseSignOut,\n} from \"firebase/auth\";\nimport { useEffect } from \"react\";\nimport create from \"zustand\";\nimport { auth } from \"./firebase\";\n\ntype IAuthMethod = \"google\";\n\ntype IAuthState =\n  | {\n      status: \"loading\";\n    }\n  | {\n      status: \"auth\";\n      authUser: {\n        userId: string;\n      };\n    }\n  | {\n      status: \"unauth\";\n    };\n\ntype IStore = {\n  authState: IAuthState;\n  setAuthState: (authState: IAuthState) => void;\n};\n\nconst useStore = create<IStore>((set) => ({\n  authState: {\n    status: \"loading\",\n  },\n  setAuthState: (authState) => set({ authState }),\n}));\n\nexport const useAuth = () => {\n  const { authState, setAuthState } = useStore();\n\n  useEffect(() => {\n    const unsubscribe = onAuthStateChanged(auth, (firebaseUser) => {\n      if (firebaseUser) {\n        setAuthState({\n          status: \"auth\",\n          authUser: {\n            userId: firebaseUser.uid,\n          },\n        });\n        return;\n      }\n\n      setAuthState({\n        status: \"unauth\",\n      });\n    });\n\n    return () => {\n      unsubscribe();\n    };\n  }, [setAuthState]);\n\n  const signIn = async ({ authMethod }: { authMethod: IAuthMethod }) => {\n    if (authMethod === \"google\") {\n      const googleAuthProvider = new GoogleAuthProvider();\n\n      await signInWithRedirect(auth, googleAuthProvider);\n\n      return [];\n    }\n\n    return [new Error(\"unsupported auth method\")];\n  };\n\n  const signOut = async () => {\n    await firebaseSignOut(auth);\n  };\n\n  return {\n    authState,\n    signIn,\n    signOut,\n  };\n};\n\nexport const useAuthUser = () => {\n  const { authState } = useAuth();\n\n  if (authState.status === \"auth\") {\n    return authState.authUser;\n  }\n\n  throw new Error(\"Trying to use auth user in an unauth context\");\n};\n"]},"metadata":{},"sourceType":"module"}