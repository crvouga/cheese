{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { onSnapshot, collection, query, where } from \"firebase/firestore\";\nimport { useEffect } from \"react\";\nimport create from \"zustand\";\nimport { firestore, storage } from \"./firebase\";\nimport { ref, uploadBytes } from \"firebase/storage\";\nconst useStore = create(set => ({\n  setProfile: profile => set({\n    profile\n  })\n}));\nconst COLLLECTION_NAME = \"profiles\";\nconst profilesRef = collection(firestore, COLLLECTION_NAME);\n\nconst toProfilePictureStorageKey = ({\n  profilePictureId\n}) => {\n  return `profilePictures/${profilePictureId}`;\n};\n\nexport const useProfile = ({\n  userId\n}) => {\n  _s();\n\n  const {\n    profile,\n    setProfile\n  } = useStore();\n  useEffect(() => {\n    const profileQuery = query(profilesRef, where(\"userId\", \"==\", userId));\n    const unsubscribe = onSnapshot(profileQuery, snapshot => {\n      const profiles = snapshot.docs.map(doc => {\n        const data = doc.data();\n        return data;\n      });\n      setProfile(profiles[0]);\n    });\n    return () => {\n      unsubscribe();\n    };\n  }, [userId, setProfile]);\n\n  const addProfile = async ({\n    profilePictureFile\n  }) => {\n    const profilePictureId = uuid;\n    const storageRef = ref(storage, toProfilePictureStorageKey({\n      profilePictureId\n    }));\n    await uploadBytes(storageRef, profilePictureFile); // await addDoc(profilesRef, profile);\n  };\n\n  return {\n    profile,\n    addProfile\n  };\n};\n\n_s(useProfile, \"xyyd5sA9q1M6QRBFRGPpqQqIzYY=\", false, function () {\n  return [useStore];\n});","map":{"version":3,"sources":["/Users/christophervouga/Documents/projects/fake-id/src/data-access/profile.ts"],"names":["onSnapshot","collection","query","where","useEffect","create","firestore","storage","ref","uploadBytes","useStore","set","setProfile","profile","COLLLECTION_NAME","profilesRef","toProfilePictureStorageKey","profilePictureId","useProfile","userId","profileQuery","unsubscribe","snapshot","profiles","docs","map","doc","data","addProfile","profilePictureFile","uuid","storageRef"],"mappings":";;AAAA,SAEEA,UAFF,EAGEC,UAHF,EAIEC,KAJF,EAKEC,KALF,QAMO,oBANP;AAOA,SAASC,SAAT,QAA0B,OAA1B;AACA,OAAOC,MAAP,MAAmB,SAAnB;AACA,SAASC,SAAT,EAAoBC,OAApB,QAAmC,YAAnC;AACA,SAAqBC,GAArB,EAA0BC,WAA1B,QAA6C,kBAA7C;AAaA,MAAMC,QAAQ,GAAGL,MAAM,CAAUM,GAAD,KAAU;AACxCC,EAAAA,UAAU,EAAGC,OAAD,IAAaF,GAAG,CAAC;AAAEE,IAAAA;AAAF,GAAD;AADY,CAAV,CAAT,CAAvB;AAIA,MAAMC,gBAAgB,GAAG,UAAzB;AACA,MAAMC,WAAW,GAAGd,UAAU,CAACK,SAAD,EAAYQ,gBAAZ,CAA9B;;AAEA,MAAME,0BAA0B,GAAG,CAAC;AAClCC,EAAAA;AADkC,CAAD,KAI7B;AACJ,SAAQ,mBAAkBA,gBAAiB,EAA3C;AACD,CAND;;AAQA,OAAO,MAAMC,UAAU,GAAG,CAAC;AAAEC,EAAAA;AAAF,CAAD,KAAoC;AAAA;;AAC5D,QAAM;AAAEN,IAAAA,OAAF;AAAWD,IAAAA;AAAX,MAA0BF,QAAQ,EAAxC;AAEAN,EAAAA,SAAS,CAAC,MAAM;AACd,UAAMgB,YAAY,GAAGlB,KAAK,CAACa,WAAD,EAAcZ,KAAK,CAAC,QAAD,EAAW,IAAX,EAAiBgB,MAAjB,CAAnB,CAA1B;AAEA,UAAME,WAAW,GAAGrB,UAAU,CAACoB,YAAD,EAAgBE,QAAD,IAAc;AACzD,YAAMC,QAAQ,GAAGD,QAAQ,CAACE,IAAT,CAAcC,GAAd,CAAmBC,GAAD,IAAS;AAC1C,cAAMC,IAAI,GAAGD,GAAG,CAACC,IAAJ,EAAb;AACA,eAAOA,IAAP;AACD,OAHgB,CAAjB;AAKAf,MAAAA,UAAU,CAACW,QAAQ,CAAC,CAAD,CAAT,CAAV;AACD,KAP6B,CAA9B;AASA,WAAO,MAAM;AACXF,MAAAA,WAAW;AACZ,KAFD;AAGD,GAfQ,EAeN,CAACF,MAAD,EAASP,UAAT,CAfM,CAAT;;AAiBA,QAAMgB,UAAU,GAAG,OAAO;AACxBC,IAAAA;AADwB,GAAP,KAMb;AACJ,UAAMZ,gBAAgB,GAAGa,IAAzB;AAEA,UAAMC,UAAU,GAAGvB,GAAG,CACpBD,OADoB,EAEpBS,0BAA0B,CAAC;AAAEC,MAAAA;AAAF,KAAD,CAFN,CAAtB;AAKA,UAAMR,WAAW,CAACsB,UAAD,EAAaF,kBAAb,CAAjB,CARI,CAUJ;AACD,GAjBD;;AAmBA,SAAO;AACLhB,IAAAA,OADK;AAELe,IAAAA;AAFK,GAAP;AAID,CA3CM;;GAAMV,U;UACqBR,Q","sourcesContent":["import {\n  addDoc,\n  onSnapshot,\n  collection,\n  query,\n  where,\n} from \"firebase/firestore\";\nimport { useEffect } from \"react\";\nimport create from \"zustand\";\nimport { firestore, storage } from \"./firebase\";\nimport { getStorage, ref, uploadBytes } from \"firebase/storage\";\n\ntype IProfile = {\n  userId: string;\n  displayName?: string;\n  profilePictureUrl?: string;\n};\n\ntype IStore = {\n  profile?: Partial<IProfile>;\n  setProfile: (profile: IProfile) => void;\n};\n\nconst useStore = create<IStore>((set) => ({\n  setProfile: (profile) => set({ profile }),\n}));\n\nconst COLLLECTION_NAME = \"profiles\";\nconst profilesRef = collection(firestore, COLLLECTION_NAME);\n\nconst toProfilePictureStorageKey = ({\n  profilePictureId,\n}: {\n  profilePictureId: string;\n}) => {\n  return `profilePictures/${profilePictureId}`;\n};\n\nexport const useProfile = ({ userId }: { userId: string }) => {\n  const { profile, setProfile } = useStore();\n\n  useEffect(() => {\n    const profileQuery = query(profilesRef, where(\"userId\", \"==\", userId));\n\n    const unsubscribe = onSnapshot(profileQuery, (snapshot) => {\n      const profiles = snapshot.docs.map((doc) => {\n        const data = doc.data();\n        return data as IProfile;\n      });\n\n      setProfile(profiles[0]);\n    });\n\n    return () => {\n      unsubscribe();\n    };\n  }, [userId, setProfile]);\n\n  const addProfile = async ({\n    profilePictureFile,\n  }: {\n    displayName: string;\n    userId: string;\n    profilePictureFile: File;\n  }) => {\n    const profilePictureId = uuid;\n\n    const storageRef = ref(\n      storage,\n      toProfilePictureStorageKey({ profilePictureId })\n    );\n\n    await uploadBytes(storageRef, profilePictureFile);\n\n    // await addDoc(profilesRef, profile);\n  };\n\n  return {\n    profile,\n    addProfile,\n  };\n};\n"]},"metadata":{},"sourceType":"module"}