{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { addDoc, onSnapshot, collection, query, where } from \"firebase/firestore\";\nimport { useEffect } from \"react\";\nimport create from \"zustand\";\nimport { firestore, storage } from \"./firebase\";\nimport { getDownloadURL, ref, uploadBytes } from \"firebase/storage\";\nimport { generateId } from \"../utils\";\nconst useStore = create(set => ({\n  setProfile: profile => set({\n    profile\n  })\n}));\nconst profilesRef = collection(firestore, \"profiles\");\nexport const useProfile = ({\n  userId\n}) => {\n  _s();\n\n  const {\n    profile,\n    setProfile\n  } = useStore();\n  useEffect(() => {\n    const profileQuery = query(profilesRef, where(\"userId\", \"==\", userId));\n    const unsubscribe = onSnapshot(profileQuery, snapshot => {\n      const profiles = snapshot.docs.map(doc => {\n        const data = doc.data();\n        return data;\n      });\n      setProfile(profiles[0]);\n    });\n    return () => {\n      unsubscribe();\n    };\n  }, [userId, setProfile]);\n\n  const uploadProfilePicture = async profilePictureFile => {\n    const storageRef = ref(storage, `profilePictures/${generateId()}`);\n    await uploadBytes(storageRef, profilePictureFile);\n    const downloadUrl = await getDownloadURL(storageRef);\n    return downloadUrl;\n  };\n\n  const addProfile = async ({\n    profilePictureFile,\n    displayName,\n    userId\n  }) => {\n    const profile = {\n      displayName,\n      userId,\n      profilePictureUrl: downloadUrl\n    };\n    await addDoc(profilesRef, profile);\n  };\n\n  return {\n    profile,\n    addProfile\n  };\n};\n\n_s(useProfile, \"xyyd5sA9q1M6QRBFRGPpqQqIzYY=\", false, function () {\n  return [useStore];\n});","map":{"version":3,"sources":["/Users/christophervouga/Documents/projects/fake-id/src/data-access/profile.ts"],"names":["addDoc","onSnapshot","collection","query","where","useEffect","create","firestore","storage","getDownloadURL","ref","uploadBytes","generateId","useStore","set","setProfile","profile","profilesRef","useProfile","userId","profileQuery","unsubscribe","snapshot","profiles","docs","map","doc","data","uploadProfilePicture","profilePictureFile","storageRef","downloadUrl","addProfile","displayName","profilePictureUrl"],"mappings":";;AAAA,SACEA,MADF,EAEEC,UAFF,EAGEC,UAHF,EAIEC,KAJF,EAKEC,KALF,QAMO,oBANP;AAOA,SAASC,SAAT,QAA0B,OAA1B;AACA,OAAOC,MAAP,MAAmB,SAAnB;AACA,SAASC,SAAT,EAAoBC,OAApB,QAAmC,YAAnC;AACA,SAASC,cAAT,EAAyBC,GAAzB,EAA8BC,WAA9B,QAAiD,kBAAjD;AACA,SAASC,UAAT,QAA2B,UAA3B;AAaA,MAAMC,QAAQ,GAAGP,MAAM,CAAUQ,GAAD,KAAU;AACxCC,EAAAA,UAAU,EAAGC,OAAD,IAAaF,GAAG,CAAC;AAAEE,IAAAA;AAAF,GAAD;AADY,CAAV,CAAT,CAAvB;AAIA,MAAMC,WAAW,GAAGf,UAAU,CAACK,SAAD,EAAY,UAAZ,CAA9B;AAEA,OAAO,MAAMW,UAAU,GAAG,CAAC;AAAEC,EAAAA;AAAF,CAAD,KAAoC;AAAA;;AAC5D,QAAM;AAAEH,IAAAA,OAAF;AAAWD,IAAAA;AAAX,MAA0BF,QAAQ,EAAxC;AAEAR,EAAAA,SAAS,CAAC,MAAM;AACd,UAAMe,YAAY,GAAGjB,KAAK,CAACc,WAAD,EAAcb,KAAK,CAAC,QAAD,EAAW,IAAX,EAAiBe,MAAjB,CAAnB,CAA1B;AAEA,UAAME,WAAW,GAAGpB,UAAU,CAACmB,YAAD,EAAgBE,QAAD,IAAc;AACzD,YAAMC,QAAQ,GAAGD,QAAQ,CAACE,IAAT,CAAcC,GAAd,CAAmBC,GAAD,IAAS;AAC1C,cAAMC,IAAI,GAAGD,GAAG,CAACC,IAAJ,EAAb;AACA,eAAOA,IAAP;AACD,OAHgB,CAAjB;AAKAZ,MAAAA,UAAU,CAACQ,QAAQ,CAAC,CAAD,CAAT,CAAV;AACD,KAP6B,CAA9B;AASA,WAAO,MAAM;AACXF,MAAAA,WAAW;AACZ,KAFD;AAGD,GAfQ,EAeN,CAACF,MAAD,EAASJ,UAAT,CAfM,CAAT;;AAiBA,QAAMa,oBAAoB,GAAG,MAAOC,kBAAP,IAAoC;AAC/D,UAAMC,UAAU,GAAGpB,GAAG,CAACF,OAAD,EAAW,mBAAkBI,UAAU,EAAG,EAA1C,CAAtB;AAEA,UAAMD,WAAW,CAACmB,UAAD,EAAaD,kBAAb,CAAjB;AAEA,UAAME,WAAW,GAAG,MAAMtB,cAAc,CAACqB,UAAD,CAAxC;AAEA,WAAOC,WAAP;AACD,GARD;;AAUA,QAAMC,UAAU,GAAG,OAAO;AACxBH,IAAAA,kBADwB;AAExBI,IAAAA,WAFwB;AAGxBd,IAAAA;AAHwB,GAAP,KAQb;AACJ,UAAMH,OAAiB,GAAG;AACxBiB,MAAAA,WADwB;AAExBd,MAAAA,MAFwB;AAGxBe,MAAAA,iBAAiB,EAAEH;AAHK,KAA1B;AAMA,UAAM/B,MAAM,CAACiB,WAAD,EAAcD,OAAd,CAAZ;AACD,GAhBD;;AAkBA,SAAO;AACLA,IAAAA,OADK;AAELgB,IAAAA;AAFK,GAAP;AAID,CApDM;;GAAMd,U;UACqBL,Q","sourcesContent":["import {\n  addDoc,\n  onSnapshot,\n  collection,\n  query,\n  where,\n} from \"firebase/firestore\";\nimport { useEffect } from \"react\";\nimport create from \"zustand\";\nimport { firestore, storage } from \"./firebase\";\nimport { getDownloadURL, ref, uploadBytes } from \"firebase/storage\";\nimport { generateId } from \"../utils\";\n\ntype IProfile = {\n  userId: string;\n  displayName?: string;\n  profilePictureUrl?: string;\n};\n\ntype IStore = {\n  profile?: Partial<IProfile>;\n  setProfile: (profile: IProfile) => void;\n};\n\nconst useStore = create<IStore>((set) => ({\n  setProfile: (profile) => set({ profile }),\n}));\n\nconst profilesRef = collection(firestore, \"profiles\");\n\nexport const useProfile = ({ userId }: { userId: string }) => {\n  const { profile, setProfile } = useStore();\n\n  useEffect(() => {\n    const profileQuery = query(profilesRef, where(\"userId\", \"==\", userId));\n\n    const unsubscribe = onSnapshot(profileQuery, (snapshot) => {\n      const profiles = snapshot.docs.map((doc) => {\n        const data = doc.data();\n        return data as IProfile;\n      });\n\n      setProfile(profiles[0]);\n    });\n\n    return () => {\n      unsubscribe();\n    };\n  }, [userId, setProfile]);\n\n  const uploadProfilePicture = async (profilePictureFile: File) => {\n    const storageRef = ref(storage, `profilePictures/${generateId()}`);\n\n    await uploadBytes(storageRef, profilePictureFile);\n\n    const downloadUrl = await getDownloadURL(storageRef);\n\n    return downloadUrl;\n  };\n\n  const addProfile = async ({\n    profilePictureFile,\n    displayName,\n    userId,\n  }: {\n    displayName: string;\n    userId: string;\n    profilePictureFile?: File;\n  }) => {\n    const profile: IProfile = {\n      displayName,\n      userId,\n      profilePictureUrl: downloadUrl,\n    };\n\n    await addDoc(profilesRef, profile);\n  };\n\n  return {\n    profile,\n    addProfile,\n  };\n};\n"]},"metadata":{},"sourceType":"module"}