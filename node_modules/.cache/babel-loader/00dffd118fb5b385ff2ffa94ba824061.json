{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { setDoc, onSnapshot, doc } from \"firebase/firestore\";\nimport { useEffect } from \"react\";\nimport create from \"zustand\";\nimport { firestore, storage } from \"./firebase\";\nimport { getDownloadURL, ref, uploadBytes } from \"firebase/storage\";\nimport { generateId } from \"../utils\";\nconst useStore = create(set => ({\n  setProfile: profile => set({\n    profile\n  })\n}));\nexport const useProfile = ({\n  userId\n}) => {\n  _s();\n\n  const {\n    profile,\n    setProfile\n  } = useStore();\n  useEffect(() => {\n    return onSnapshot(doc(firestore, \"profiles\", userId), doc => {\n      const profile = doc.data();\n      setProfile(profile);\n    });\n  }, [userId, setProfile]);\n\n  const uploadProfilePicture = async profilePictureFile => {\n    if (profilePictureFile) {\n      const storageRef = ref(storage, `profilePictures/${generateId()}`);\n      await uploadBytes(storageRef, profilePictureFile);\n      const downloadUrl = await getDownloadURL(storageRef);\n      return downloadUrl;\n    }\n\n    return null;\n  };\n\n  const setProfileDoc = async profile => {\n    await setDoc(doc(firestore, \"profiles\", profile.userId), profile);\n  };\n\n  return {\n    profile\n  };\n};\n\n_s(useProfile, \"xyyd5sA9q1M6QRBFRGPpqQqIzYY=\", false, function () {\n  return [useStore];\n});","map":{"version":3,"sources":["/Users/christophervouga/Documents/projects/fake-id/src/data-access/profile.ts"],"names":["setDoc","onSnapshot","doc","useEffect","create","firestore","storage","getDownloadURL","ref","uploadBytes","generateId","useStore","set","setProfile","profile","useProfile","userId","data","uploadProfilePicture","profilePictureFile","storageRef","downloadUrl","setProfileDoc"],"mappings":";;AAAA,SAEEA,MAFF,EAGEC,UAHF,EAMEC,GANF,QAQO,oBARP;AASA,SAASC,SAAT,QAA0B,OAA1B;AACA,OAAOC,MAAP,MAAmB,SAAnB;AACA,SAASC,SAAT,EAAoBC,OAApB,QAAmC,YAAnC;AACA,SAASC,cAAT,EAAyBC,GAAzB,EAA8BC,WAA9B,QAAiD,kBAAjD;AACA,SAASC,UAAT,QAA2B,UAA3B;AAaA,MAAMC,QAAQ,GAAGP,MAAM,CAAUQ,GAAD,KAAU;AACxCC,EAAAA,UAAU,EAAGC,OAAD,IAAaF,GAAG,CAAC;AAAEE,IAAAA;AAAF,GAAD;AADY,CAAV,CAAT,CAAvB;AAIA,OAAO,MAAMC,UAAU,GAAG,CAAC;AAAEC,EAAAA;AAAF,CAAD,KAAoC;AAAA;;AAC5D,QAAM;AAAEF,IAAAA,OAAF;AAAWD,IAAAA;AAAX,MAA0BF,QAAQ,EAAxC;AAEAR,EAAAA,SAAS,CAAC,MAAM;AACd,WAAOF,UAAU,CAACC,GAAG,CAACG,SAAD,EAAY,UAAZ,EAAwBW,MAAxB,CAAJ,EAAsCd,GAAD,IAAS;AAC7D,YAAMY,OAAO,GAAGZ,GAAG,CAACe,IAAJ,EAAhB;AACAJ,MAAAA,UAAU,CAACC,OAAD,CAAV;AACD,KAHgB,CAAjB;AAID,GALQ,EAKN,CAACE,MAAD,EAASH,UAAT,CALM,CAAT;;AAOA,QAAMK,oBAAoB,GAAG,MAAOC,kBAAP,IAAqC;AAChE,QAAIA,kBAAJ,EAAwB;AACtB,YAAMC,UAAU,GAAGZ,GAAG,CAACF,OAAD,EAAW,mBAAkBI,UAAU,EAAG,EAA1C,CAAtB;AAEA,YAAMD,WAAW,CAACW,UAAD,EAAaD,kBAAb,CAAjB;AAEA,YAAME,WAAW,GAAG,MAAMd,cAAc,CAACa,UAAD,CAAxC;AAEA,aAAOC,WAAP;AACD;;AACD,WAAO,IAAP;AACD,GAXD;;AAaA,QAAMC,aAAa,GAAG,MAAOR,OAAP,IAIhB;AACJ,UAAMd,MAAM,CAACE,GAAG,CAACG,SAAD,EAAY,UAAZ,EAAwBS,OAAO,CAACE,MAAhC,CAAJ,EAA6CF,OAA7C,CAAZ;AACD,GAND;;AAQA,SAAO;AACLA,IAAAA;AADK,GAAP;AAGD,CAlCM;;GAAMC,U;UACqBJ,Q","sourcesContent":["import {\n  addDoc,\n  setDoc,\n  onSnapshot,\n  collection,\n  query,\n  doc,\n  where,\n} from \"firebase/firestore\";\nimport { useEffect } from \"react\";\nimport create from \"zustand\";\nimport { firestore, storage } from \"./firebase\";\nimport { getDownloadURL, ref, uploadBytes } from \"firebase/storage\";\nimport { generateId } from \"../utils\";\n\ntype IProfile = {\n  userId: string;\n  displayName?: string;\n  profilePictureUrl?: string;\n};\n\ntype IStore = {\n  profile?: Partial<IProfile>;\n  setProfile: (profile?: IProfile) => void;\n};\n\nconst useStore = create<IStore>((set) => ({\n  setProfile: (profile) => set({ profile }),\n}));\n\nexport const useProfile = ({ userId }: { userId: string }) => {\n  const { profile, setProfile } = useStore();\n\n  useEffect(() => {\n    return onSnapshot(doc(firestore, \"profiles\", userId), (doc) => {\n      const profile = doc.data() as IProfile | undefined;\n      setProfile(profile);\n    });\n  }, [userId, setProfile]);\n\n  const uploadProfilePicture = async (profilePictureFile?: File) => {\n    if (profilePictureFile) {\n      const storageRef = ref(storage, `profilePictures/${generateId()}`);\n\n      await uploadBytes(storageRef, profilePictureFile);\n\n      const downloadUrl = await getDownloadURL(storageRef);\n\n      return downloadUrl;\n    }\n    return null;\n  };\n\n  const setProfileDoc = async (profile: {\n    displayName: string;\n    userId: string;\n    profilePictureUrl: string;\n  }) => {\n    await setDoc(doc(firestore, \"profiles\", profile.userId), profile);\n  };\n\n  return {\n    profile,\n  };\n};\n"]},"metadata":{},"sourceType":"module"}